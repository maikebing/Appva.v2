@model Appva.Mcss.Admin.Models.ListTenaModel
@{
    Layout = null;
}
<script>
    $(document).ready(function () {
        $("#ExternalId").on("input", function () {
            if (this.value.length == 8) {
                $.ajax({
                    url: '@Url.Action("find","tena")',
                    type: 'GET',
                    data: { 'ExternalId': this.value },
                    success: function (result) {
                        var message = JSON.parse(result);
                        console.log(result);
                        if (message.StatusCode == 800) {
                            resetError();
                            $('.tena-response-facility').html(message.FacilityName);
                            $('.tena-response-room').html(message.RoomNumber);
                            $('#tena-response').show();
                            $('.button--primary').prop('disabled', false);
                            $('.button--secondary').prop('disabled', false).click(function (e) {
                                e.preventDefault();
                                $('#ExternalId').val('');
                                reset();
                            });
                            $('.button--primary').prop('disabled', false);
                        } else {
                            console.log(message.StatusMessage);
                            $('.tena-error-message').html(message.StatusMessage);
                            $('#tena-error').show();
                        }
                    }
                });
            } else {
                reset();
                resetError();
            }
        });
        function reset() {
            $('.button--primary').prop('disabled', true);
            $('.button--secondary').prop('disabled', true);
            $('#tena-response').css('display', 'none');
            $('.tena-response-facility').html('');
            $('.tena-response-room').html('');
        }
        function resetError() {
            $('#tena-error').css('display', 'none');
            $('.tena-error-message').html('');
        }
    });
</script>
<div class="main" id="main" role="main">
    <div class="section section--hspace section--vspace section--lightblue">
        <h2 style="text-align:center;">Börja använda TENA Identifi</h2>
        <div class="section section--hspace section--vspace section--white width-limiter width-limiter--xs">
        @using (Html.BeginForm("activate", "tena"))
        {
            <p>För att kunna använda TENA Identifi tillsammans med MCSS måste du först ange den boendes motsvarande ID i Identifi här.</p>

            <div class="text-align--center">
                <p>
                    <svg class="icon icon--round icon--info" aria-hidden="true">
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/Assets/images/icons/icon.sprite.svg#questionmark-icon"></use>
                    </svg>
                    <a href="#" class="read-more-link">Var du hittar TENA Identifi ID</a>
                </p>
                <div class="form-controls inliner inliner--align-center">
                    @Html.LabelFor(x => x.ExternalId, "Identifi ID")
                    <span class="required-indicator" style="padding:0 10px 0 5px">*</span>
                    @Html.TextBoxFor(x => x.ExternalId, new { size = "8" })
                </div>
                <div id="target">
                    <div id="tena-error" class="section section--narrow section--blue section--bubble section--hspace section--vspace inliner" style="display:none;">
                        <p class="tena-error-message"></p>
                    </div>
                    <div id="tena-response" class="section section--narrow section--blue section--bubble section--hspace section--vspace inliner" style="display:none;padding-bottom:20px;">
                        <dl style="text-align:left; width:100px; margin-right:30px;">
                            <dt>Plats:</dt>
                            <dd class="tena-response-facility"></dd>
                        </dl>
                        <dl style="text-align:left; width:100px;">
                            <dt>Rum:</dt>
                            <dd class="tena-response-room"></dd>
                        </dl>
                    </div>
                    <div class="form-controls form-controls--align-end">
                        <button class="button button--secondary" type="reset" disabled>Ångra</button>
                        <button class="button button--primary" type="submit" disabled>Aktivera</button>
                    </div>
                </div>
            </div>
        }
        </div>
    </div>
</div>